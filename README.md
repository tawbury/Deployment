# Kubernetes K3s Deployment ν”„λ΅μ νΈ

μ΄ ν”„λ΅μ νΈλ” Kubernetes(K3s) λ° μ»¨ν…μ΄λ„ κΈ°λ° μΈν”„λΌ κµ¬μ¶•μ„ μ„ν• ν†µν•© κ΄€λ¦¬ μ €μ¥μ†μ…λ‹λ‹¤. ArgoCDλ¥Ό ν†µν• GitOps λ°©μ‹μ λ°°ν¬μ™€ λ¨λ‹ν„°λ§ μ¤νƒμ„ ν¬ν•¨ν•κ³  μμµλ‹λ‹¤.

## π“‹ λ©μ°¨

- [ν”„λ΅μ νΈ κ°μ”](#ν”„λ΅μ νΈ-κ°μ”)
- [ν”„λ΅μ νΈ κµ¬μ΅°](#ν”„λ΅μ νΈ-κµ¬μ΅°)
- [λΉ λ¥Έ μ‹μ‘](#λΉ λ¥Έ-μ‹μ‘)
- [μ£Όμ” κµ¬μ„± μ”μ†](#μ£Όμ”-κµ¬μ„±-μ”μ†)
- [μΈν”„λΌ μ„¤μ •](#μΈν”„λΌ-μ„¤μ •)
- [λ°°ν¬ κ°€μ΄λ“](#λ°°ν¬-κ°€μ΄λ“)
- [κ°λ° κ°€μ΄λ“](#κ°λ°-κ°€μ΄λ“)

## ν”„λ΅μ νΈ κ°μ”

μ΄ ν…ν”λ¦Ώμ€ λ‹¤μμ„ μ κ³µν•©λ‹λ‹¤:

- **GitOps κΈ°λ° λ°°ν¬**: ArgoCDλ¥Ό ν™μ©ν• Kubernetes μ„ μ–Έμ  λ°°ν¬ κ΄€λ¦¬
- **λ‹¤μ¤‘ ν™κ²½ μ§€μ›**: `base` λ° `overlays` κµ¬μ΅°λ¥Ό ν†µν• ν™κ²½λ³„ μ„¤μ • κ΄€λ¦¬ (Production/Staging)
- **λ¨λ‹ν„°λ§ μ¤νƒ**: Prometheus, Grafana, Alertmanager ν†µν•©
- **μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ΄λ„ν™”**: `observer`, `qts` λ“± ν•µμ‹¬ μ—”μ§„μ Docker λΉλ“ λ° λ°°ν¬ μ„¤μ •
- **λ°μ΄ν„°λ² μ΄μ¤ μΈν”„λΌ**: PostgreSQL (Bitnami Helm κΈ°λ° λλ” μμ²΄ μ •μ) λ° PVC κ΄€λ¦¬

## ν”„λ΅μ νΈ κµ¬μ΅°

```
Deployment/
β”β”€β”€ app/                            # μ• ν”λ¦¬μΌ€μ΄μ… Docker λΉλ“ ν™κ²½
β”‚   β”β”€β”€ observer/                   # Observer μ—”μ§„ Dockerfile λ° μ„¤μ •
β”‚   β””β”€β”€ qts/                        # QTS μ—”μ§„ κ΄€λ ¨ μ„¤μ •
β”‚
β”β”€β”€ infra/                          # μΈν”„λΌ μ„¤μ • (K8s & Shared)
β”‚   β”β”€β”€ k8s/                        # Kubernetes λ§¤λ‹νμ¤νΈ (Kustomize κµ¬μ΅°)
β”‚   β”‚   β”β”€β”€ base/                   # κΈ°λ³Έ λ¦¬μ†μ¤ μ •μ (λ¨λ“  ν™κ²½ κ³µν†µ)
β”‚   β”‚   β”‚   β”β”€β”€ deployments/        # μ• ν”λ¦¬μΌ€μ΄μ… λ° DB λ°°ν¬ (postgres, observer λ“±)
β”‚   β”‚   β”‚   β”β”€β”€ services/           # λ΅λ“λ°Έλ°μ„ λ° λ‚΄λ¶€ μ„λΉ„μ¤ μ„¤μ •
β”‚   β”‚   β”‚   β”β”€β”€ ingress/            # μ ‘κ·Ό μ μ–΄λ¥Ό μ„ν• Ingress μ„¤μ •
β”‚   β”‚   β”‚   β”β”€β”€ pvc/                # νΌμ‹μ¤ν„΄νΈ λ³Όλ¥¨ ν΄λ μ„ (λ°μ΄ν„° μ €μ¥μ†)
β”‚   β”‚   β”‚   β”β”€β”€ configmaps/         # κ³µν†µ μ„¤μ •κ°’
β”‚   β”‚   β”‚   β”β”€β”€ namespaces/         # λ„¤μ„μ¤νμ΄μ¤ μ •μ
β”‚   β”‚   β”‚   β”β”€β”€ monitoring/         # Prometheus/Grafana K8s λ¦¬μ†μ¤
β”‚   β”‚   β”‚   β”β”€β”€ sealed-secrets/     # λ³΄μ•μ„ μ„ν•΄ μ•”νΈν™”λ μ‹ν¬λ¦Ώ
β”‚   β”‚   β”‚   β””β”€β”€ kustomization.yaml  # Kustomize μ„¤μ •
β”‚   β”‚   β””β”€β”€ overlays/               # ν™κ²½λ³„ μ¤λ²„λΌμ΄λ“ μ„¤μ •
β”‚   β”‚       β””β”€β”€ production/         # ν”„λ΅λ•μ… ν™κ²½ μ „μ© μ„¤μ • (ArgoCD μ°Έμ΅°μ )
β”‚   β”‚
β”‚   β”β”€β”€ _shared/                    # λ κ±°μ‹ λ° κ³µν†µ κ³µμ  λ¦¬μ†μ¤
β”‚   β”‚   β”β”€β”€ monitoring/             # λ…λ¦½ μ‹¤ν–‰ν• λ¨λ‹ν„°λ§ μ„¤μ • (Prometheus.yml λ“±)
β”‚   β”‚   β”β”€β”€ migrations/             # DB μ΄κΈ°ν™” λ° λ§μ΄κ·Έλ μ΄μ… SQL
β”‚   β”‚   β””β”€β”€ secrets/                # λ΅μ»¬ ν…μ¤νΈμ© μ‹ν¬λ¦Ώ (Git λΉ„ν¬ν•¨)
β”‚   β””β”€β”€ _legacy/                    # μ΄μ „ λ²„μ „ νΈν™μ© μ„¤μ •
β”‚
β”β”€β”€ .github/                        # CI/CD μλ™ν™” (GitHub Actions)
β”‚   β””β”€β”€ workflows/                  # μ΄λ―Έμ§€ λΉλ“ λ° μλ™ νƒκΉ… μ›ν¬ν”λ΅μ°
β”‚
β”β”€β”€ docs/                           # μ„¤μΉ λ° μ΄μ κ°€μ΄λ“ λ¬Έμ„
β”β”€β”€ ops/                            # μ΄μ μ§€μ› μ¤ν¬λ¦½νΈ
β”β”€β”€ tests/                          # μΈν”„λΌ κ²€μ¦μ© ν…μ¤νΈ μ½”λ“
β””β”€β”€ README.md                       # μ΄ νμΌ
```

## λΉ λ¥Έ μ‹μ‘

### 1. μ‚¬μ „ μ”κµ¬μ‚¬ν•­

- **Kubernetes**: K3s λλ” ν‘μ¤€ K8s ν΄λ¬μ¤ν„°
- **Tools**: `kubectl`, `kustomize`
- **GitOps**: ArgoCD (κ¶μ¥)

### 2. Kustomizeλ¥Ό μ΄μ©ν• λ΅μ»¬ λΉλ“ ν…μ¤νΈ

```bash
# base λ¦¬μ†μ¤ λΉλ“ ν™•μΈ
kubectl kustomize infra/k8s/base

# production μ¤λ²„λ μ΄ λΉλ“ ν™•μΈ
kubectl kustomize infra/k8s/overlays/production
```

### 3. ArgoCDλ¥Ό ν†µν• λ°°ν¬

μ΄ μ €μ¥μ†λ¥Ό ArgoCDμ μ†μ¤(Repository URL)λ΅ λ“±λ΅ν•κ³ , `infra/k8s/overlays/production` κ²½λ΅λ¥Ό λ€μƒμΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ„ μƒμ„±ν•©λ‹λ‹¤.

## μ£Όμ” κµ¬μ„± μ”μ†

### μ• ν”λ¦¬μΌ€μ΄μ… μ΄λ―Έμ§€ (`app/`)
- ν•µμ‹¬ μ„λΉ„μ¤ μ—”μ§„μ Docker μ΄λ―Έμ§€λ¥Ό λΉλ“ν•κΈ° μ„ν• ν™κ²½μ…λ‹λ‹¤.
- GitHub Actionsλ¥Ό ν†µν•΄ λΉλ“λ μ΄λ―Έμ§€λ” GHCRμ— μ €μ¥λ©λ‹λ‹¤.

### Kubernetes μΈν”„λΌ (`infra/k8s/`)
- **Base**: λ¨λ“  ν™κ²½μ—μ„ κ³µν†µμ μΌλ΅ μ‚¬μ©λλ” λ¦¬μ†μ¤μ μ›ν•μ…λ‹λ‹¤.
- **Overlays**: νΉμ • ν™κ²½(Production λ“±)μ— λ§κ² CPU/Memory μ ν•, μΈμ¤ν„΄μ¤ μ, νΈμ¤νΈλ„¤μ„ λ“±μ„ λ³€κ²½ν•©λ‹λ‹¤.

### λ°μ΄ν„° κ΄€λ¦¬ λ° μ§€μ†μ„±
- **PVC**: `/opt/platform/runtime/` κ²½λ΅μ μκµ¬ μ €μ¥μ†λ¥Ό κ΄€λ¦¬ν•©λ‹λ‹¤.
- **Sealed Secrets**: Git μ €μ¥μ†μ— μ•μ „ν•κ² μ‹ν¬λ¦Ώμ„ μ €μ¥ν•κΈ° μ„ν•΄ `sealed-secrets`λ¥Ό μ‚¬μ©ν•©λ‹λ‹¤.

## μΈν”„λΌ μ„¤μ •

### λ¨λ‹ν„°λ§
Kubernetes λ‚΄λ¶€μ `infra/k8s/base/monitoring` μ„¤μ •μ„ ν†µν•΄ ν΄λ¬μ¤ν„° λ¦¬μ†μ¤μ™€ μ• ν”λ¦¬μΌ€μ΄μ… λ©”νΈλ¦­μ„ μμ§‘ν•©λ‹λ‹¤.

### λ΅κΉ… λ° μ¤ν† λ¦¬μ§€
μ• ν”λ¦¬μΌ€μ΄μ… λ΅κ·Έλ” κ° PVCμ— λ§μ΄νΈλ κ²½λ΅(`.../logs/`)μ— μ €μ¥λλ©°, νΈμ¤νΈ μ„λ²„μ μ‹¤μ  κ²½λ΅μ™€ λ§¤ν•‘λ©λ‹λ‹¤.

## λ°°ν¬ κ°€μ΄λ“

μμ„Έν• λ°°ν¬ ν”„λ΅μ„Έμ¤λ” [docs/README.md](docs/README.md)λ¥Ό μ°Έμ΅°ν•μ‹­μ‹μ¤.

## π”„ λ³€κ²½ μ΄λ ¥

| λ‚ μ§ | λ²„μ „ | λ³€κ²½ μ‚¬ν•­ |
|------|------|---------|
| 2026-02-04 | v2.0 | Kubernetes (K3s) λ° Kustomize κΈ°λ° κµ¬μ΅°λ΅ μ „λ©΄ κ°νΈ |
| 2026-01-27 | v1.1 | κ³µν†µ λ¦¬μ†μ¤λ¥Ό `infra/_shared/`λ΅ ν†µν•© |
| 2026-01-27 | v1.0 | μ΄κΈ° ν…ν”λ¦Ώ κµ¬μ΅° μƒμ„± |

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2026-02-04
